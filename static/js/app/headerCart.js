$(function(){if(checkLogin("notlogin")){getCartList();}});function showDefualtCartList(){$(".center ul").empty();$(".cc_center ul").empty();if($(".center ul li").length==0){var ab='<li ><div ><i class="shop_car_img"></i></div></li><li style="margin-bottom:40px;">购物车还没有商品,赶紧选购吧  !</li>';$(".center ul").append(ab);$(".cc_center ul").append(ab);$(".settleup_s .cartips").hide();}$(".totalnum").text(0);$(".totalusd").text("");$(".totalcny").text("");$(".Goods_title .g6").hide();$(".Goods_title .cc_add_car").hide();$(".listlast").hide();$(".cc_go_car").hide();}function showLoadingCartList(){$(".center ul").empty();$(".cc_center ul").empty();var li1=$("<li/>",{"class":"morelist"}).append($("<div style='margin-top:40px;'><img src='"+ykyUrl.portal+"/images/static/yky-loading.gif'/></div>"));var li2=$("<li/>",{"class":"morelist"});li2.text("购物车正在努力加载中...");$(".center ul").append(li1);$(".center ul").append(li2);$(".cc_center ul").append(li1);$(".cc_center ul").append(li2);$(".Goods_title .g3").hide();$(".Goods_title .cc_add_car").hide();$(".listlast").hide();$(".cc_go_car").hide();}function fixPriceMargin(fixedCny,fixedUsd){if((fixedCny>0)&&(fixedUsd>0)){$(".list_info.l.mr10").css("margin-top","0px");$(".newGoods .listlast").css("height","54px");$(".newGoods .cc_go_car").css("height","54px");}else{$(".list_info.l.mr10").css("margin-top","10px");}}function showCartListData(result){$(".center ul").empty();$(".cc_center ul").empty();var fixedCny=0;var fixedUsd=0;$.each(result,function(index,item){var listId=item.shoppingCartId;var price="--";var node=item.categoryName||"--";var npm=item.mpn;var producrImgUrl=item.productImgUrl?item.productImgUrl:ykyUrl.portal+"/images/static/yky300.png";var quantity=item.quantity;var currencyUom=item.currency=="CNY"?"￥":"$";var productIDs=item.productId;if(item.unitPrice){price=Number(item.unitPrice);price=checkPrice(price);quantity=Number(quantity);if(!isNaN(price)&&!isNaN(quantity)){if(item.currency=="CNY"){fixedCny=Number(Number(fixedCny)+Number(price*quantity)).toFixed(2);fixedCny=fixedCny<0.01?0.01:fixedCny;}else{fixedUsd=Number(Number(fixedUsd)+Number(price*quantity)).toFixed(2);fixedUsd=fixedCny<0.01?0.01:fixedCny;}}}var aa='<li class="cc"><div class="g_img l"><a href="'+ykyUrl.portal+"/search/?s="+productIDs+'><img class="producrImg" src="'+producrImgUrl+'"></a></div><div class="list_info"><p class="g3 f16 npm" title="'+npm+'"><a style="width: 200px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;" href="'+ykyUrl.portal+"/search/?s="+productIDs+'>'+npm+'</a></p><p class="categoryName" style="width: 200px;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">'+node+'</p><p class="g_detail"><i style="color:#036eb8;" class="currency">'+currencyUom+'</i><i style="color:#036eb8;" class="pricecny">'+price+'</i> × <i class="quantitycny">'+quantity+'</i></p></div><div class="delete"><p class="r" data-id='+listId+" productid="+productIDs+'>删除</p></div><div style="top: 63px;left: 20px;position: absolute;width: 290px;border-top: 1px dashed #F1EFEF;"></div></li>';$(".center ul").append(aa);$(".cc_center ul").append(aa);});var totalcnyVal=fixedCny===0?"":"￥"+fixedCny;$(".totalcny").text(totalcnyVal);var totalusdVal=fixedUsd===0?"":"$"+fixedUsd;$(".totalusd").text(totalusdVal);if($("#_shopCar").length){$("#_shopCar").mCustomScrollbar();}fixPriceMargin(fixedCny,fixedUsd);if($(".center ul li").hasClass("cc")){$(".totalnum").text($(".center ul li").length);$(".settleup_s .tip_cart .totalnum").text($(".center ul li").length>99?"99+":$(".center ul li").length);}else{$(".totalnum").text(0);}$(".newGoods .delete p").on("click",deleteShoppingCart);}function checkPrice(num){var num=String(num);var pos=num.indexOf(".");var priceAll="";if(pos>0){var priceE=num.substring(pos);var priceS=num.substring(0,pos);if(priceE.length<3){priceE=priceE+"0";}priceAll=priceS+priceE;}else{priceAll=num+".00";}return priceAll;}function deleteShoppingCart(){var _this=this;var productId;var listId;productId=$(_this).attr("productid");listId=$(_this).attr("data-id");$.aAjax({type:"DELETE",async:true,url:ykyUrl.cartPort+"/v1/carts/"+listId+"?ids="+productId,contentType:"application/json",dataType:"text",success:function(){var prodIdList=[];prodIdList.push(productId);gaObj&&gaObj.delProductClick(prodIdList);getCartList();},error:function(e){getCartList();}});}function getCartList(){showLoadingCartList();$(".settleup_s .cartips").show();$(".Goods_title .g3").show();$(".Goods_title .cc_add_car").show();$(".listlast").show();$(".cc_go_car").show();$.aAjax({type:"GET",url:ykyUrl.cartPort+"/v1/carts/mincartlist",dataType:"json",success:function(result){if(result.length===0){showDefualtCartList();return;}showCartListData(result);},error:function(e){showDefualtCartList();}});}