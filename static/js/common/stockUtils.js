var keyWords="";function getNewUrl(addParamenters,delParameters){var url=window.location.href;var search=window.location.search;var host=ykyUrl.portal+"/search/?s=";if(url.indexOf("/kw/")>0){keyWords="keyword";var keyword=url.substring(url.indexOf("kw/")+3,url.indexOf(".htm"));var keywordNew=keyword.replace(/\//g,"%2F");keywordNew=keywordNew.replace(/\\/g,"%5C");if(search){url=host+search+"&keyword="+keywordNew;}else{url=host+"?keyword="+keywordNew;}}if(url.indexOf("/cate/")>0){var cat=url.substring(url.indexOf("cate/")+5,url.indexOf(".htm"));cat=cat.replace(/\//g,"%2F");cat=cat.replace(/\\/g,"%5C");if(cat.indexOf("-")>0){if(search){url=host+search+"&cat="+cat.substring(0,cat.indexOf("-"))+"&manufacturer="+cat.substring(cat.indexOf("-")+1);}else{url=host+"?cat="+cat.substring(0,cat.indexOf("-"))+"&manufacturer="+cat.substring(cat.indexOf("-")+1);}}else{if(search){url=host+search+"&cat="+cat;}else{url=host+"?cat="+cat;}}}if(url.indexOf("/vendor/")>0){if(search){url=host+search+"&vendorId="+url.substring(url.indexOf("vendor/")+7,url.indexOf(".htm"));}else{url=host+"?vendorId="+url.substring(url.indexOf("vendor/")+7,url.indexOf(".htm"));}}var newUrl="";if(typeof(url)=="undefined"||url==null){return url;}if(url.indexOf("kw")>0){newUrl=url;}if((typeof(delParameters)=="undefined"||delParameters==null||delParameters.length<=0)&&(typeof(addParamenters)=="undefined"||addParamenters==null||addParamenters.length<=0)){return url;}if(typeof(delParameters)!="undefined"&&delParameters!=null&&delParameters.length>0){if(url.indexOf("?")!=-1&&url.indexOf("&")==-1){var urlArray=url.split("?");var delFlag=false;for(var j=0;j<delParameters.length;j++){if(urlArray[1].split("=")[0]==delParameters[j]){delFlag=true;break;}}if(!delFlag){newUrl=urlArray[0]+"?"+urlArray[1];}else{newUrl=urlArray[0];}}else{if(url.indexOf("?")!=-1&&url.indexOf("&")!=-1){var urlArray=url.split("?");newUrl=urlArray[0]+"?";var parametersArray=urlArray[1].split("&");for(var i=0;i<parametersArray.length;i++){var delFlag=false;for(var j=0;j<delParameters.length;j++){if(parametersArray[i].split("=")[0]==delParameters[j]){delFlag=true;break;}}if(!delFlag){newUrl=newUrl+parametersArray[i]+"&";}}if(newUrl.lastIndexOf("&")==newUrl.length-1){newUrl=newUrl.substring(0,newUrl.length-1);}}else{if(url.indexOf("?")==-1&&url.indexOf("&")==-1){newUrl=url;if(url.indexOf(".htm")==-1){var lastStr=url.substring(url.length-1);if(lastStr=="/"){newUrl=url.slice(0,-1)+".htm";}}}}}}if(typeof(addParamenters)!="undefined"&&addParamenters!=null&&addParamenters.length>0){for(var j=0;j<addParamenters.length;j++){if(newUrl.indexOf("?")==-1){if(url.indexOf("/cate/")>=0&&addParamenters[j].name==="cat"){var urlArr=url.split("/cate/");var urlEnd=urlArr[1].substring(urlArr[1].indexOf("."));if(urlArr[1].indexOf("page")!=-1){urlEnd=urlArr[1].substring(urlArr[1].indexOf("."),urlArr[1].indexOf("page")-1);}newUrl=urlArr[0]+"/cate/"+addParamenters[j].value+urlEnd;}else{newUrl=newUrl+"?"+addParamenters[j].name+"="+addParamenters[j].value;}}else{if(url.indexOf("/cate/")>=0&&addParamenters[j].name==="cat"){var urlArr=url.split("/cate/");var urlEnd=urlArr[1].substring(urlArr[1].indexOf("."));if(urlArr[1].indexOf("page")!=-1){urlEnd=urlArr[1].substring(urlArr[1].indexOf("."),urlArr[1].indexOf("page")-1);}newUrl=urlArr[0]+"/cate/"+addParamenters[j].value+urlEnd;}else{if(newUrl.substring(newUrl.length-1)==="?"){newUrl=newUrl+addParamenters[j].name+"="+addParamenters[j].value;}else{newUrl=newUrl+"&"+addParamenters[j].name+"="+addParamenters[j].value;}}}}}return newUrl;}function changeSort(type,rule){var addParameters=null,delParameters=null;delParameters=new Array("page","sort");if(typeof(type)!="undefined"&&type!=null&&type.length>0&&typeof(rule)!="undefined"&&rule!=null&&rule.length>0){addParameters=new Array({name:"sort",value:type+"."+rule});}window.location.href=getNewUrl(addParameters,delParameters);}function changeSortClass(){$(".sort-stock").addClass("icon-indicate");$(".sort-time").addClass("icon-indicate");var sort=getParameter("sort");var type=$("body.isPurchase").length?0:1;var txtDesc=$("body.isPurchase").length?"需求从多到少":"库存从多到少";var txtAsc=$("body.isPurchase").length?"需求从少到多":"库存从少到多";if(typeof(sort)=="undefined"||sort==null){var color=$("body.isPurchase").length?"#2396f5;":"red";$("#sortDefuAId").attr("style","color:"+color);return;}if(sort.indexOf("stock.desc")!=-1){$(".sort-stock-text").attr("style","color: #EE2535;");$(".sort-stock-text").html(txtDesc);$(".sort-stock-text-b").attr("style","color: #2396f5;");$(".sort-stock-text-b").html(txtDesc);$(".sort_newtime").addClass("ml40");}else{if(sort.indexOf("stock.asc")!=-1){$(".sort-stock-text").attr("style","color: #EE2535;");$(".sort-stock-text").html(txtAsc);$(".sort-stock-text-b").attr("style","color: #2396f5;");$(".sort-stock-text-b").html(txtAsc);$(".sort_newtime").addClass("ml40");}}if(sort.indexOf("time.desc")!=-1){$(".sort-time-text").attr("style","color: #EE2535;");$(".sort-time-text").html("更新时间从新到旧");$(".sort-time-text-b").attr("style","color: #2396f5;");$(".sort-time-text-b").html("更新时间从新到旧");}else{if(sort.indexOf("time.asc")!=-1){$(".sort-time-text").attr("style","color: #EE2535;");$(".sort-time-text").html("更新时间从旧到新");$(".sort-time-text-b").attr("style","color: #2396f5;");$(".sort-time-text-b").html("更新时间从旧到新");}}}function brandToggle(brandIn){var tabListOther=$("a[data-initial]");$.each(tabListOther,function(j,t){$(t).hide();});var tabList=$("a[data-initial='"+brandIn+"']");$.each(tabList,function(j,t){$(t).toggle();});}function brandToggleCss(brandIn){var tabListOther=$("a[data-initial-key]");$.each(tabListOther,function(j,t){$(t).removeClass("curent");});$("a[data-initial-key='"+brandIn+"']").addClass("curent");var tabListOther=$("a[data-initial]");$.each(tabListOther,function(j,t){$(t).hide();});var tabList=$("a[data-initial='"+brandIn+"']");$.each(tabList,function(j,t){$(t).toggle();});}function brandShowAll(){var tabListOther=$("a[data-initial]");$.each(tabListOther,function(j,t){$(t).show();});}function brandShowAllCss(){var tabListOther=$("a[data-initial]");$.each(tabListOther,function(j,t){$(t).show();});var tabListOther=$("a[data-initial-key]");$.each(tabListOther,function(j,t){$(t).removeClass("curent");});$("a[data-initial-key='All']").addClass("curent");}function addParamCat(cat){var delParameters=new Array("page","certificate","sort","cat");var addParameters=new Array({name:"cat",value:cat});window.location.href=getNewUrl(addParameters,delParameters);}function delParamBrand(){var delParameters=new Array("page","certificate","sort","brand","standard");var addParameters=new Array({name:"standard",value:1});window.location.href=getNewUrl(addParameters,delParameters);}function delParamBrand(rst){var delParameters=new Array("page","certificate","sort","brand","standard");var addParameters=new Array({name:"standard",value:1});window.location.href=getNewUrl(addParameters,delParameters);}function addParamBrand(brand){var delParameters=new Array("page","certificate","sort","brand");var addParameters=new Array({name:"brand",value:encodeURIComponent(brand)});window.location.href=getNewUrl(addParameters,delParameters);}function addParamAttr(attr){var parAttr=getParameter("attr");var delParameters=new Array("page","attr");var addParameters=null;if(null==parAttr){addParameters=new Array({name:"attr",value:attr});}else{if(parAttr.indexOf(attr)>-1){parAttr=parAttr.replace(","+attr);parAttr=parAttr.replace(attr+",");parAttr=parAttr.replace(attr);}else{parAttr+=","+attr;}if(parAttr!="undefined"&&parAttr!=""){addParameters=new Array({name:"attr",value:parAttr});}}window.location.href=getNewUrl(addParameters,delParameters);}function verificationInquiryAauthority(ctx,ykyAuthFlag,type,url,successUrl){var content={"ykyAuthFlag":ykyAuthFlag,"type":type};var rstFlag=true;$.ajax({type:"GET",async:false,url:ctx+"/rest/inquire/verificationInqQuoAuth",contentType:"application/json;charset=UTF-8",data:content,success:function(data){if(data.result=="401"){if(typeof(url)=="undefined"||url==null||url==""){window.location.href=window.location.href;}else{if(typeof(url)!="undefined"&&url!=null){window.open(url);}}}else{if(data.result=="403"){rstFlag=false;var enterpriseType=data.enterpriseType;var enterpriseProps=data.enterpriseProps;var ykyAuthFlag=data.ykyAuthFlag;var winTis=false;if(type==1){if(enterpriseType==0){if(ykyAuthFlag==1){winTis=true;$("#tisDivId").html("抱歉！您还不是认证会员");$("#tisDivId2").html("您需要成为认证会员后才能进行询价");}else{winTis=true;$("#tisDivId").html("抱歉！您还未获得询价权限");$("#tisDivId2").html("您需要认证后才能进行询价");}}else{if(enterpriseType==1){winTis=true;$("#tisDivId").html("抱歉！您还不是认证会员");$("#tisDivId2").html("您需要成为认证会员后才能进行询价");}else{if(enterpriseType==6&&ykyAuthFlag==1){layer.alert("抱歉！您是供应商，不能直接采购，如需采购，请联系客服",{icon:2,area:["520px"],shadeClose:false});}else{layer.alert("抱歉！如需采购分销商库存，请直接联系分销商",{icon:2,area:["520px"],shadeClose:false});}}}}else{if(enterpriseType==0||enterpriseType==1){winTis=true;$("#tisDivId").html("抱歉！您还不是认证会员");$("#tisDivId2").html("您需要成为认证会员后才能进行报价");}else{if(enterpriseType==6&&(enterpriseProps+"").indexOf("1")>-1){layer.alert("抱歉！您是分销商，不能直接报价，如需报价，请联系客服",{icon:2,area:["520px"],shadeClose:true});}else{layer.alert("抱歉！您是采购商，不能直接报价，如需报价，请联系客服",{icon:2,area:["520px"],shadeClose:true});}}}if(winTis){var iWidth=480;var iHeight=280;var iTop=(window.screen.availHeight-30-iHeight)/3;var iLeft=(window.screen.availWidth-10-iWidth)/2;var index=layer.open({type:1,title:"温馨提示",shade:0.8,area:[iWidth+"px",iHeight+"px"],offset:[iTop+"px",iLeft+"px"],content:$("#errorDialog")});}}else{if(typeof(successUrl)!="undefined"&&successUrl!=null){window.open(successUrl);}}}},error:function(XMLHttpRequest,textStatus,errorThrown){if(type==1){window.location.href=ctx+"/stock/inquireFail.htm";}else{window.location.href=ctx+"/purchase/quotationFailed.htm";}}});return rstFlag;}function stockInquire(ctx,id,ykyAuthFlag){var qty=$("#_qty").val();var url=ctx+"/stock/toInquire.htm?id="+id+"&qty="+qty;return verificationInquiryAauthority(ctx,ykyAuthFlag,1,url,url);}function purchaseInquire(ctx,id){var url=ctx+"/purchase/quotation.htm?id="+id;return verificationInquiryAauthority(ctx,1,0,url,url);}